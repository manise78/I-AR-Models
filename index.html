<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <title>Visualizzatore AR</title>
    <script type="module"
            src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
    </script>
    <style>
        body { margin: 0; background: #f0f0f0; }
        model-viewer { width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<model-viewer id="viewer"
              src=""
              ar
              ar-modes="webxr scene-viewer quick-look"
              camera-controls
              touch-action="pan-y"
              shadow-intensity="1">
</model-viewer>

<script>
(async function () {

    const params = new URLSearchParams(window.location.search);
    const model = params.get('model');

    if (!model) {
        alert('Nessun modello specificato.');
        return;
    }

    try {
        // Scarica il file GLB dal repository con cache-busting
        const response = await fetch('./' + model + '?t=' + Date.now());
        if (!response.ok) throw new Error("Errore HTTP durante il download del modello");

        const blob = await response.blob();
        const blobUrl = URL.createObjectURL(blob);

        const viewer = document.getElementById('viewer');
        viewer.src = blobUrl;   // Imposta il modello dinamicamente
        await viewer.updateComplete; // Attendi il caricamento
        viewer.load();           // Aggiorna il pulsante AR

    } catch (err) {
        alert('Impossibile scaricare il modello: ' + model);
        console.error(err);
    }

})();
</script>

</body>
</html>
