<body>
    <div id="status" style="position: absolute; top: 10px; left: 10px; z-index: 10; font-family: sans-serif; background: rgba(255,255,255,0.8); padding: 5px; border-radius: 5px;">
        In attesa del modello...
    </div>

    <model-viewer id="viewer" 
        ar ar-modes="webxr scene-viewer quick-look" 
        camera-controls shadow-intensity="1" 
        auto-rotate
        style="width: 100vw; height: 100vh; background-color: #f0f0f0;">
    </model-viewer>

    <script>
        const params = new URLSearchParams(window.location.search);
    const model = params.get('model');
    if (model) {
        // Il "+ '?t=' + new Date().getTime()" serve a fregare la cache di GitHub
        document.getElementById('viewer').src = model + "?t=" + new Date().getTime();
        const viewer = document.getElementById('viewer');
        const status = document.getElementById('status');

        if (model) {
            status.innerText = "Caricamento: " + model;
            // Forziamo il caricamento assoluto
            const modelUrl = window.location.origin + window.location.pathname.replace('index.html', '') + model + "?t=" + new Date().getTime();
            
            viewer.src = modelUrl;

            viewer.addEventListener('load', () => {
                status.style.display = 'none'; // Nascondi se ok
            });

            viewer.addEventListener('error', (ev) => {
                status.innerHTML = "‚ùå Errore caricamento.<br>Verifica link: <a href='"+modelUrl+"'>Clicca qui</a>";
                console.error(ev);
            });
        } else {
            status.innerText = "Nessun modello specificato.";
        }
    </script>
</body>
