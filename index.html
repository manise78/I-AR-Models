<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <title>Visualizzatore AR</title>
    <!-- Carica la libreria Model‑Viewer -->
    <script type="module"
            src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js">
    </script>
    <style>
        body { margin:0; }
        model-viewer { width:100vw; height:100vh; background:#f0f0f0; }
    </style>
</head>
<body>
    <!-- Viewer con AR abilitata -->
    <model-viewer id="viewer"
                  ar
                  ar-modes="webxr scene-viewer quick-look"
                  camera-controls
                  touch-action="pan-y"
                  shadow-intensity="1">
        <!-- Pulsante personalizzato -->
        <div slot="ar-button"
             style="position:absolute;bottom:16px;right:16px;">
            <button style="
                    padding:12px;
                    border-radius:8px;
                    border:none;
                    background:#007bff;
                    color:white;
                    font-weight:bold;">
                VEDI IN AR
            </button>
        </div>
    </model-viewer>

    <script>
        (function () {
            // Legge i parametri dell’URL (es. ?model=nome.glb&ar)
            const params = new URLSearchParams(window.location.search);
            const model = params.get('model');

            if (!model) {
                alert('Nessun modello specificato.');
                return;
            }

            const viewer = document.getElementById('viewer');

            /* 
             * Prefisso '/' in modo che il browser punti al root del repo
             * (es. /myModel.glb).  Se il modello si trova in una
             * cartella (es. assets/), usare '/assets/' + model
             */
            viewer.src = '/' + model + '?t=' + Date.now();

            // Notifica in caso di errore di caricamento
            viewer.addEventListener('error', () => {
                alert('Impossibile caricare il modello ' + model);
            });

            // (Opzionale) Log di caricamento
            viewer.addEventListener('model-loading', () => {
                console.log('Caricamento modello in corso...');
            });
        })();
    </script>
</body>
</html>
