<!DOCTYPE html>
<html>
<head>
    <title>AR Viewer</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <style>
        body { margin: 0; font-family: sans-serif; }
        model-viewer { width: 100vw; height: 100vh; background-color: #f0f0f0; }
        #status { position: absolute; top: 10px; left: 10px; z-index: 100; background: white; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="status">Inizializzazione...</div>

    <model-viewer id="viewer" ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" auto-rotate></model-viewer>

    <script>
        const status = document.getElementById('status');
        const viewer = document.getElementById('viewer');
        const params = new URLSearchParams(window.location.search);
        const model = params.get('model');

        if (!model) {
            status.innerHTML = "‚ùå Errore: Manca il nome del modello nell'URL.";
        } else {
            status.innerHTML = "üîç Cerco il file: " + model;
            
            // Forziamo l'indirizzo assoluto per evitare dubbi
            const modelUrl = window.location.origin + window.location.pathname.replace('index.html', '') + model + "?t=" + Date.now();
            
            viewer.src = modelUrl;

            viewer.addEventListener('load', () => {
                status.style.display = 'none';
                console.log("Modello caricato con successo");
            });

            viewer.addEventListener('error', (ev) => {
                console.error(ev);
                status.innerHTML = "‚ùå ERRORE DI CARICAMENTO!<br>" +
                                 "File: <a href='" + modelUrl + "'>" + model + "</a><br>" +
                                 "Controlla se il link sopra scarica il file. Se lo scarica, il problema √® il visualizzatore.";
            });
        }
    </script>
</body>
</html>
